# _proxy-rules.conf
# --------------------------------------------------------------------------------- #

# SetEnv SERVERIP

# ServerAdmin

ErrorLog ${APACHE_LOG_DIR}/error.log
CustomLog ${APACHE_LOG_DIR}/access.log combined

ErrorDocument 500 "500 Server error"
ErrorDocument 502 "502 Server error"
ErrorDocument 404 "404 Server error"
ErrorDocument 401 "401 Server error"

<IfModule mod_proxy.c>

    ProxyPreserveHost On
    ProxyRequests Off
    # ServerName
    RemoteIPHeader X-Forwarded-For
    RequestHeader unset X-Forwarded-For
    RequestHeader unset X-Forwarded-Host
    RequestHeader unset X-Forwarded-Server

    <Proxy *>
        AddDefaultCharset off
        Order deny,allow
        Allow from all
    </Proxy>

    # Enable/disable the handling of HTTP/1.1 "Via:" headers.
    # ("Full" adds the server version; "Block" removes all outgoing Via: headers)
    # Set to one of: Off | On | Full | Block

    ProxyVia Block

    ErrorDocument 500 "500 Proxy error"
    ErrorDocument 502 "502 Proxy error"
    ErrorDocument 404 "404 Proxy error"
    ErrorDocument 401 "401 Proxy error"

    <IfModule mod_ssl.c>

        ErrorDocument 500 "500 Secured Proxy error"
        ErrorDocument 502 "502 Secured Proxy error"
        ErrorDocument 404 "404 Secured Proxy error"
        ErrorDocument 401 "401 Secured Proxy error"

        <FilesMatch "\.(cgi|shtml|phtml|php)$">
            SSLOptions +StdEnvVars
        </FilesMatch>

        <Directory /usr/lib/cgi-bin>
            SSLOptions +StdEnvVars
        </Directory>

        BrowserMatch "MSIE [2-6]" \
            nokeepalive ssl-unclean-shutdown \
            downgrade-1.0 force-response-1.0
        BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

    </IfModule>

</IfModule>
