# 0000_proxy.rules_0.conf
# --------------------------------------------------------------------------------- #

# SetEnv SERVERIP

# ServerAdmin

ErrorLog ${APACHE_LOG_DIR}/proxy_X_error.log
CustomLog ${APACHE_LOG_DIR}/proxy_X_access.log combined

ErrorDocument 500 "Maintenance... >0"
ErrorDocument 502 "Maintenance... >2"
ErrorDocument 403 "Maintenance... >3"
ErrorDocument 404 "Maintenance... >4"
ErrorDocument 401 "Maintenance... >1"

<IfModule mod_proxy.c>

    ProxyPreserveHost On
    ProxyRequests Off
    # ServerName
    RemoteIPHeader X-Forwarded-For
    RequestHeader unset X-Forwarded-For
    RequestHeader unset X-Forwarded-Host
    RequestHeader unset X-Forwarded-Server

    SetEnv force-proxy-request-1.0 1
    SetEnv proxy-nokeepalive 1
    SetEnv proxy-initial-not-pooled 1

    <Proxy *>
        AddDefaultCharset off
        Order deny,allow
        Allow from all
    </Proxy>

    # Enable/disable the handling of HTTP/1.1 "Via:" headers.
    # ("Full" adds the server version; "Block" removes all outgoing Via: headers)
    # Set to one of: Off | On | Full | Block

    ProxyVia Block

    ErrorDocument 500 "Maintenance... >>0"
    ErrorDocument 502 "Maintenance... >>2"
    ErrorDocument 503 "Maintenance... >>3"
    ErrorDocument 404 "Maintenance... >>4"
    ErrorDocument 401 "Maintenance... >>1"

    <IfModule mod_ssl.c>

        ErrorDocument 500 "Maintenance... <0"
        ErrorDocument 502 "Maintenance... <2"
        ErrorDocument 403 "Maintenance... <3"
        ErrorDocument 404 "Maintenance... <4"
        ErrorDocument 401 "Maintenance... <1"

        <FilesMatch "\.(cgi|shtml|phtml|php)$">
            SSLOptions +StdEnvVars
        </FilesMatch>

        <Directory /usr/lib/cgi-bin>
            SSLOptions +StdEnvVars
        </Directory>

        BrowserMatch "MSIE [2-6]" \
            nokeepalive ssl-unclean-shutdown \
            downgrade-1.0 force-response-1.0
        BrowserMatch "MSIE [17-9]" ssl-unclean-shutdown

    </IfModule>

</IfModule>
